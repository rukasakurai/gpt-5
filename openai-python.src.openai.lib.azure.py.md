# openai-python/src/openai/lib/azure.py

> **Warming:** Generated by AI

As of 2025 October 27, [OpenAI Python API library](https://github.com/openai/openai-python)â€™s Azure client implementations (`AzureOpenAI` and `AsyncAzureOpenAI`) do **not** call generic OpenAI REST endpoints under a `/v1/...` path. Instead, they follow the Azure OpenAI pattern:

```
https://{your-resource}.azure.openai.com/openai
https://{your-resource}.azure.openai.com/openai/deployments/{deployment}
```

Versioning is supplied via the `api-version` query parameter (e.g. `?api-version=2024-XX-YY`) rather than a `/v1` path segment.

## Evidence in `src/openai/lib/azure.py`

1. Base URL construction (no `/v1`):
   - Synchronous client: lines [216-231](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L216-L231) build `base_url` with `/openai` or `/openai/deployments/{azure_deployment}`.
   - Asynchronous client: lines [497-509](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L497-L509) mirror the same logic.

2. API version passed as query parameter:
   - Sync: line [211](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L211) sets `default_query = {"api-version": api_version}` (or merges it).
   - Async: line [492](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L492) does the same.

3. Dynamic insertion of deployment path for certain feature endpoints:
   - Lines [57-68](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L57-L68) adjust request URLs to include `/deployments/{model}` for endpoints like `/chat/completions`, `/embeddings`, etc., still under `/openai`, not `/v1`.

4. URL preparation when an Azure endpoint + deployment is configured:
   - Lines [71-86](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L71-L86) show `_prepare_url` composing `.../openai/{feature}` by manipulating raw paths (again, no `/v1`).

5. Realtime endpoint configuration:
   - Sync realtime: lines [341-364](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L341-364) use `self._prepare_url("/realtime")` and append `api-version` as a query parameter.
   - Async realtime: lines [624-647](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L624-647) replicate the same pattern.

6. Authentication headers differ from generic OpenAI usage:
   - Sync auth setup: lines [322-337](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L322-337) prefer `api-key` header or `Authorization: Bearer <AAD token>`.
   - Async auth setup: lines [605-622](https://github.com/openai/openai-python/blob/4e8856576211064b09c0cc4a1ed35b82b169abe2/src/openai/lib/azure.py#L605-622) mirror this logic.

## Summary

All Azure requests constructed by these clients:
- Use a base of `{endpoint}/openai` (optionally including `/deployments/{deployment}`).
- Add the API version with `api-version` query string.
- Never hardcode or assume a `/v1` path segment unless a caller manually overrides `base_url` with such a path.

To target a specific Azure OpenAI API version, set either:
- The `api_version` argument when instantiating the client, or
- The `OPENAI_API_VERSION` environment variable.

Example (synchronous):

```python
from openai.lib.azure import AzureOpenAI

client = AzureOpenAI(
    azure_endpoint="https://my-resource.azure.openai.com/",
    api_version="2024-10-01-preview",
    api_key="...",
    azure_deployment="gpt-4o-mini"
)

resp = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": "Hello"}]
)
```

This results in a request like:
```
GET/POST https://my-resource.azure.openai.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-10-01-preview
```

## Notes

If you explicitly pass a `base_url` containing `/v1`, you bypass the Azure-specific construction and would be responsible for ensuring correctness yourself.
